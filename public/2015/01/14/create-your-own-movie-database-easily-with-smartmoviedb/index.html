<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Create your own movie database easily with SmartMovieDB!</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://toubou91.github.io/2015/01/14/create-your-own-movie-database-easily-with-smartmoviedb/">
  <link rel="alternate" type="application/rss+xml" title="Thodoris Bais around Software and Life" href="http://toubou91.github.io/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Thodoris Bais around Software and Life</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Create your own movie database easily with SmartMovieDB!</h1>
    <p class="post-meta"><time datetime="2015-01-14T00:10:00+01:00" itemprop="datePublished">Jan 14, 2015</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">toubou91</span></span></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <div dir="ltr" style="text-align:left;"><div dir="ltr" style="text-align:left;"><h2 style="text-align:left;"><span style="color:red;">You can directly jump to the <a href="https://github.com/toubou91/SmartMovieDB" target="_blank">git repository</a> that hosts this project :)</span></h2><br />There's a pretty nice <a href="http://bobbelderbos.com/2011/11/movie-database-imdb-api-perl/" target="_blank">source </a>over the internet, regarding the creation of your own movie database.<br />You can read in detail its usage and functionality over the fore-mentioned link, but, generally, the following schematic explains how it works:<br /><div class="separator" style="clear:both;text-align:center;"><a href="https://thodorisbais.files.wordpress.com/2015/01/b6161-untitled-1.png" style="margin-left:1em;margin-right:1em;"><img border="0" src="https://thodorisbais.files.wordpress.com/2015/01/b6161-untitled-1.png" height="239" width="320" /></a></div><br />That is, you give as an input a text file that contains the desired movies' names and with the help of the perl scrapper, you get an output of an sql format with all the sql commands that need to be done to your database.<br /><br />This means of course some extra effort, so why don't we go for an automatic process? What about an <code>sql</code> script runner, which takes as an input an SQL file, connects to the specified database and runs the generated from the scrapper script, queries?  It would be nice if we could stick with Perl, but I didn't had the luxury to waste a lot of time on Perl-MySQL connection, so I chose the easy way, which is Java and fortunately, there is an easy way to do it, again with the support of an open source project (we 'll here need only one <a href="http://stackoverflow.com/questions/1044194/running-a-sql-script-using-mysql-with-jdbc" target="_blank">part</a><a href="http://stackoverflow.com/questions/1044194/running-a-sql-script-using-mysql-with-jdbc"></a> of it, as you noticed, too).<br /><br />I'm choosing to start with the Java project, which is responsible for reading an sql file and executing the included queries to a given database connection:<br /><div class="separator" style="clear:both;text-align:center;"><br /></div><div class="separator" style="clear:both;text-align:center;"><a href="http://snag.gy/Ype1r.jpg" style="margin-left:1em;margin-right:1em;"><img border="0" src="http://snag.gy/Ype1r.jpg" /></a></div><br /><ul style="text-align:left;"><li><code>DatabaseConnection.java</code> defines a valid database connection.</li><li><code>ScriptRunner.java</code> is responsible for the convertion of sql statements into databse queries.</li><li><code>MainClass.java</code> coordinates the game, as the script runner's instance needs a connection argument, which is actually passed by calling the <code>getConnection()</code> static method of <code>DatabaseConnection.java</code>. </li></ul>And that's is! We 're good to go with the script runner's part.<br /><br /><b>What is left now, is to find a way to connect the script runner (that takes an sql file and executes the existing queries into a db) with the perl scrapper.</b><br /><i><br /></i><i>According to the scrapper's part, I'd firstly like to introduce a small parenthesis: I support open source software, so I'm here using the <a href="http://www.omdbapi.com/" target="_blank">OMDB Api</a>, instead of the iMDB's API, so, together with some updates that had to be done to the scrapper script, here is the updated version of <code>getMovieData.pl</code>:</i><br /><br /><pre class="brush:perl; highlight: [12, 17, 23, 25]">#!/usr/bin/perl -w<br />use strict; <br />use XML::Simple;<br />use Data::Dumper;<br /><br />my $xml = new XML::Simple;<br /><br />die "Please make that you the movie title is provided into quotes!\n" if(!@ARGV);<br />my $movie = shift;<br />$movie =~ s/\s/+/g;<br /><br />my $cmd = "curl http://www.omdbapi.com/?t=$movie&amp;y=&amp;plot=short&amp;r=xml";<br />my $movieData = `$cmd`;<br />my $data = $xml-&gt;XMLin( $movieData );<br /><br />my $released = escapeSingleQuote($data-&gt;{movie}-&gt;{released});<br />my $rating = escapeSingleQuote($data-&gt;{movie}-&gt;{imdbRating});<br />my $director = escapeSingleQuote($data-&gt;{movie}-&gt;{director});<br />my $genre = escapeSingleQuote($data-&gt;{movie}-&gt;{genre});<br />my $writer = escapeSingleQuote($data-&gt;{movie}-&gt;{writer});<br />my $runtime = escapeSingleQuote($data-&gt;{movie}-&gt;{runtime});<br />my $plot = escapeSingleQuote($data-&gt;{movie}-&gt;{plot});<br />my $imdb = escapeSingleQuote($data-&gt;{movie}-&gt;{imdbID});<br />my $title = escapeSingleQuote($data-&gt;{movie}-&gt;{title});<br />my $votes = escapeSingleQuote($data-&gt;{movie}-&gt;{imdbVotes});<br />my $poster = escapeSingleQuote($data-&gt;{movie}-&gt;{poster});<br />my $year = escapeSingleQuote($data-&gt;{movie}-&gt;{year});<br />my $rated = escapeSingleQuote($data-&gt;{movie}-&gt;{rated});<br />my $actors = escapeSingleQuote($data-&gt;{movie}-&gt;{actors});<br /><br />my $tstamp = time();<br /><br />print "INSERT INTO movie_collection VALUES (NULL , '$title', '$year', ";<br />print "'$rated', '$released', '$genre', '$director', '$writer', '$actors', '$plot', ";<br />print "'$poster', '$runtime', '$rating', '$votes', '$imdb', '$tstamp');\n";<br /><br />sub escapeSingleQuote {<br /> my $str = shift;<br /> $str =~ s/\'/\\'/g;<br /> return $str;<br />}<br /></pre><br />Once the sql file creation is done , we 'll make a <code>system</code> call from Perl to run the exported <code>jar</code> file of our Java project. This means that we need to add the following line in the end of the <code>batch.pl</code> script:   </div><pre class="brush: perl; ruler: true; highlight: [6]">#!/usr/bin/perl<br />while(){ <br /> my $cmd = "perl getMovieData.pl \"$_\""; <br /> system($cmd);<br />}<br />system "java -jar absolute/path/to/the/exported/jar/file.jar"<br /></pre>Finally, everything is fired up from command line, so, keeping in mind the exact locations of the required files (movies list, jar and generates sql's file), execute the following command: <br /><pre class="brush: perl">perl batch.pl movielist.txt &gt; sqlInserts.sql<br /></pre><br />For more details, there's also a <a href="https://github.com/toubou91/SmartMovieDB" target="_blank"><span style="color:red;"><b>git repository</b></span></a> that hosts this project :) </div>

  </div>

</article>

<div id="disqus_thread"></div>
<script>

/**
 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables */
/*
var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
	var disqus_url = "http://thodorisbais.com/2015/01/14/create-your-own-movie-database-easily-with-smartmoviedb/";
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//thodorisbais.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>	


      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Thodoris Bais around Software and Life</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Thodoris Bais around Software and Life</li>
          <li><a href="mailto:thodoris.bais@gmail.com">thodoris.bais@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/toubou91"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">toubou91</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/ThodorisBais"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">ThodorisBais</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>This is my personal blog and contains several experiences around software and life. I write what I think others will benefit from. You judge whether it helped or not.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
